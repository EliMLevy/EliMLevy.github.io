let ps;function setup(){canvas=createCanvas(windowWidth,windowHeight),canvas.position(0,0),canvas.style("z-index",-1),ps=new System(50)}function mouseDragged(){ps.addP(mouseX,mouseY);}function windowResized(){resizeCanvas(windowWidth,windowHeight)}function draw(){background(128,162,217),ps.run()}class Particle{constructor(t,i){this.pos=createVector(t,i),this.vel=createVector(random(1),random(1)),this.acc=createVector(),this.maxSpeed=2,this.life=random(2e3,3e3),this.r=3,this.leader=void 0,this.follower=void 0,this.n=0}update(){null!=this.leader&&this.arrive(this.leader.pos),this.vel.add(this.acc),this.pos.add(this.vel),this.acc.mult(0),this.checkEdges(),this.life--}arrive(t){let i=p5.Vector.sub(this.leader.pos,this.pos),s=i.mag(),e=this.maxSpeed;s<100&&(e=map(s,0,100,0,this.maxSpeed)),s<0&&(this.leader=void 0),i.setMag(e);let l=p5.Vector.sub(i,this.vel);this.applyForce(l)}checkEdges(){this.pos.x<-this.r&&(this.pos.x=width+this.r,null!=this.follower&&(this.follower.n=0)),this.pos.y<-this.r&&(this.pos.y=height+this.r,null!=this.follower&&(this.follower.n=0)),this.pos.x>width+this.r&&(this.pos.x=-this.r,null!=this.follower&&(this.follower.n=0)),this.pos.y>height+this.r&&(this.pos.y=-this.r,null!=this.follower&&(this.follower.n=0))}show(){null!=this.leader?(strokeWeight(1),this.n=lerp(this.n,100,.01),stroke(0,this.n),line(this.pos.x,this.pos.y,this.leader.pos.x,this.leader.pos.y)):this.n=0;let t=map(this.life,0,2e3,0,120);fill(0,t),noStroke(),ellipse(this.pos.x,this.pos.y,2*this.r)}applyForce(t){this.acc.add(t)}}class System{constructor(t){this.particles=[],this.carryingCapacity=t;for(let i=0;i<t;i++)this.particles[i]=new Particle(random(width),random(height))}run(){for(let t=this.particles.length-1;t>=0;t--){if(this.particles[t].show(),this.particles[t].update(),random(1)<.01&&void 0===this.particles[t].leader){let i=floor(random(this.particles.length));i!=t&&void 0===this.particles[i].follower&&(this.particles[t].leader=this.particles[i],this.particles[i].follower=this.particles[t])}this.particles[t].life<0&&(null!=this.particles[t].follower&&(this.particles[t].follower.leader=void 0,this.particles[t].follower.n=0),null!=this.particles[t].leader&&(this.particles[t].leader.follower=void 0),this.particles.splice(t,1))}this.particles.length<this.carryingCapacity&&random(this.carryingCapacity/this.particles.length)>1&&this.particles.push(new Particle(random(width),random(height)))}addP(x,y){this.particles.push(new Particle(x,y));}}