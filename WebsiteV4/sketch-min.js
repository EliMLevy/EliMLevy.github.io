let ps,pulse=0;function setup(){canvas=createCanvas(windowWidth,windowHeight),canvas.position(0,0),canvas.style("z-index",-1),ps=new System(100),frameRate(30)}function mouseDragged(){ps.addP(mouseX,mouseY)}function windowResized(){resizeCanvas(windowWidth,windowHeight)}function draw(){background(128,162,217),ps.run()}class System{constructor(t){this.particles=[],this.carryingCapacity=t;for(let s=0;s<t;s++)this.particles[s]=new Particle(random(width),random(height))}run(){for(let t=this.particles.length-1;t>=0;t--){if(this.particles[t].show(),this.particles[t].update(),random(1)<.01&&void 0===this.particles[t].leader){let s=floor(random(this.particles.length));s!=t&&void 0===this.particles[s].follower&&(this.particles[t].leader=this.particles[s],this.particles[s].follower=this.particles[t])}this.particles[t].life<0&&(null!=this.particles[t].follower&&(this.particles[t].follower.leader=void 0,this.particles[t].follower.n=0),null!=this.particles[t].leader&&(this.particles[t].leader.follower=void 0),this.particles.splice(t,1))}this.particles.length<this.carryingCapacity&&random(this.carryingCapacity/this.particles.length)>1&&this.particles.push(new Particle(random(width),random(height)))}addP(t,s){this.particles.push(new Particle(t,s))}}class Particle{constructor(t,s){this.pos=createVector(t,s),this.vel=createVector(random(-1,1),random(-1,1)),this.acc=createVector(),this.maxSpeed=2,this.life=random(2e3,3e3),this.r=6,this.leader=void 0,this.follower=void 0,this.n=0,this.c=[random(255),random(255),random(255)]}update(){null!=this.leader&&this.arrive(this.leader.pos),this.vel.add(this.acc),this.pos.add(this.vel),this.acc.mult(0),this.checkEdges(),this.life--}arrive(t){let s=p5.Vector.sub(this.leader.pos,this.pos),i=s.mag(),e=this.maxSpeed;i<100&&(e=map(i,0,100,0,this.maxSpeed)),i<1&&(this.leader=void 0),s.setMag(e);let l=p5.Vector.sub(s,this.vel);this.applyForce(l)}checkEdges(){this.pos.x<-this.r&&(this.pos.x=width+this.r,null!=this.follower&&(this.follower.n=0)),this.pos.y<-this.r&&(this.pos.y=height+this.r,null!=this.follower&&(this.follower.n=0)),this.pos.x>width+this.r&&(this.pos.x=-this.r,null!=this.follower&&(this.follower.n=0)),this.pos.y>height+this.r&&(this.pos.y=-this.r,null!=this.follower&&(this.follower.n=0))}show(){let t,s;null!=this.leader?(strokeWeight(1),this.n=lerp(this.n,100,.01),stroke(0,this.n),line(this.pos.x,this.pos.y,this.leader.pos.x,this.leader.pos.y)):this.n=0;let i=map(this.life,0,1e3,0,120);fill(0,i),noStroke(),push(),translate(this.pos.x,this.pos.y),s=null!=this.leader?(t=p5.Vector.sub(this.leader.pos,this.pos)).heading():this.vel.heading(),rotate(s),triangle(-10,-6,-10,6,20,0),pop()}applyForce(t){this.acc.add(t)}}