let ps,speedSlider,connectionSlider,reset,pulse=0;function setup(){canvas=createCanvas(windowWidth,windowHeight),canvas.position(0,0),canvas.style("z-index",-1),(speedSlider=createSlider(1,10,7,.5)).position(10,height-40),speedSlider.style("width","300px"),(connectionSlider=createSlider(1e-5,.08,.08,2e-6)).position(360,height-40),connectionSlider.style("width","300px"),(reset=createButton("Reset")).position(690,height-40),reset.style("width","100px"),reset.mousePressed(restartSystem),ps=new System(300),frameRate(30)}function restartSystem(){ps=new System(300),speedSlider.value(7),connectionSlider.value(.08)}function mouseDragged(){mouseY<height-40&&ps.addP(mouseX,mouseY)}function windowResized(){resizeCanvas(windowWidth,windowHeight)}function draw(){background(3,35*cos(pulse)+146,252),fill(0,100),rect(0,height-50,width,50),stroke(0,50),strokeWeight(1),line(mouseX,0,mouseX,height),line(0,mouseY,width,mouseY),ps.run(),pulse+=.02}class Particle{constructor(e,t){this.pos=createVector(e,t),this.vel=createVector(random(-4,4),random(-4,4)),this.acc=createVector(),this.maxSpeed=speedSlider.value(),this.life=random(2e3,3e3),this.r=6,this.leader=void 0,this.follower=void 0,this.n=0,this.c=[random(255),random(255),random(255)]}update(){null!=this.leader&&this.arrive(this.leader.pos),this.vel.add(this.acc),this.pos.add(this.vel),this.acc.mult(0),this.checkEdges(),this.life--}arrive(e){let t=p5.Vector.sub(this.leader.pos,this.pos),i=t.mag(),s=speedSlider.value();i<100&&(s=map(i,0,100,0,speedSlider.value())),i<1&&(this.leader=void 0),t.setMag(s);let l=p5.Vector.sub(t,this.vel);l.limit(.4),this.applyForce(l)}checkEdges(){this.pos.x<-this.r&&(this.pos.x=width+this.r,null!=this.follower&&(this.follower.n=0)),this.pos.y<-this.r&&(this.pos.y=height+this.r,null!=this.follower&&(this.follower.n=0)),this.pos.x>width+this.r&&(this.pos.x=-this.r,null!=this.follower&&(this.follower.n=0)),this.pos.y>height+this.r&&(this.pos.y=-this.r,null!=this.follower&&(this.follower.n=0))}show(){null!=this.leader?(strokeWeight(3),this.n=lerp(this.n,100,.01),stroke(0,this.n),line(this.pos.x,this.pos.y,this.leader.pos.x,this.leader.pos.y)):this.n=0;map(this.life,0,1e3,0,120);fill(0,20),noStroke(),void 0===this.leader&&this.vel.mag()>.3&&ellipse(this.pos.x,this.pos.y,2*this.r)}applyForce(e){this.acc.add(e)}}class System{constructor(e){this.particles=[],this.carryingCapacity=e;for(let t=0;t<e;t++)this.particles[t]=new Particle(random(width),random(height))}run(){for(let e=this.particles.length-1;e>=0;e--){if(this.particles[e].show(),this.particles[e].update(),random(1)<connectionSlider.value()&&void 0===this.particles[e].leader){let t=floor(random(this.particles.length));t!=e&&void 0===this.particles[t].follower&&(this.particles[e].leader=this.particles[t],this.particles[t].follower=this.particles[e])}this.particles[e].life<0&&(null!=this.particles[e].follower&&(this.particles[e].follower.leader=void 0,this.particles[e].follower.n=0),null!=this.particles[e].leader&&(this.particles[e].leader.follower=void 0),this.particles.splice(e,1))}this.particles.length<this.carryingCapacity&&random(this.carryingCapacity/this.particles.length)>1&&this.particles.push(new Particle(random(width),random(height)))}addP(e,t){this.particles.push(new Particle(e,t))}}